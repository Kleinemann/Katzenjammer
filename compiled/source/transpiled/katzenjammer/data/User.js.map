{
  "version": 3,
  "sources": [
    "C:/Workspace/katzenjammer/source/class/katzenjammer/data/User.js"
  ],
  "names": [
    "qx",
    "Bootstrap",
    "executePendingDefers",
    "$$dbClassInfo",
    "Class",
    "define",
    "extend",
    "core",
    "Object",
    "type",
    "statics",
    "Instance",
    "properties",
    "ID",
    "init",
    "nullable",
    "Session",
    "Name",
    "Home",
    "Money",
    "Guild",
    "Buildings",
    "Quests",
    "construct",
    "katzenjammer",
    "data",
    "User",
    "members",
    "gameInterval",
    "buildings",
    "getBuildings",
    "i",
    "building",
    "quest",
    "getQuest",
    "console",
    "log",
    "getName",
    "getID",
    "Quest",
    "createNewQuest",
    "questCont",
    "container",
    "MainContainer",
    "getQuests",
    "addQuest",
    "questData",
    "user_building_id",
    "setUserBuilding",
    "setQuest",
    "loadingUser",
    "args",
    "resetID",
    "resetSession",
    "resetName",
    "resetHome",
    "resetMoney",
    "resetGuild",
    "resetBuildings",
    "value",
    "setID",
    "setName",
    "setSession",
    "setHome",
    "setMoney",
    "setGuild",
    "loadingUserData",
    "updateHome",
    "homeData",
    "Action",
    "Data",
    "id",
    "home",
    "getHome",
    "req",
    "ServiceRequest",
    "send",
    "loadingUserBuildings",
    "user",
    "addListener",
    "e",
    "response",
    "getTarget",
    "getResponse",
    "success",
    "UserBuilding",
    "setBuildings",
    "loadingHeroes",
    "loadingQuests",
    "hero",
    "name",
    "GameData",
    "Heroes",
    "hero_id",
    "icon_id",
    "building_id",
    "bHeroes",
    "getHeroes",
    "push",
    "setHeroes",
    "updateBuildingList",
    "quests",
    "b",
    "setQuests",
    "updateQuestList"
  ],
  "mappings": "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",
  "sourcesContent": [
    "﻿/* global katzenjammer */\r\n/**\r\n*\r\n * @asset(katzenjammer/*)\r\n*\r\n**/\r\nqx.Class.define(\"katzenjammer.data.User\", {\r\n    extend: qx.core.Object,\r\n    type: \"singleton\",\r\n\r\n    statics:\r\n    {\r\n        Instance: null\r\n    },\r\n\r\n    properties:\r\n    {\r\n        ID: { init: null, nullable: true },\r\n        Session: { init: null, nullable: true },\r\n        Name: { init: null, nullable: true },\r\n        Home: { init: null, nullable: true },\r\n        Money: { init: null, nullable: true },\r\n        Guild: { init: null, nullable: true },\r\n\r\n        Buildings: { init: null, nullable: true },\r\n        Quests: { init: null, nullable: true },\r\n    },\r\n\r\n    construct: function () {\r\n        this.base(arguments);\r\n\r\n        katzenjammer.data.User.Instance = this;\r\n    },\r\n\r\n    members:\r\n    {\r\n        gameInterval: function () {\r\n            var buildings = this.getBuildings();\r\n            for (var i in buildings) {\r\n                var building = buildings[i];\r\n                var quest = building.getQuest();\r\n\r\n                if (quest === null)\r\n                {\r\n                    console.log(building.getName() + \" (\" + building.getID() + \") benötigt eine Quest.\");\r\n                    var quest = katzenjammer.data.Quest.createNewQuest(building);\r\n\r\n                    var questCont = katzenjammer.container.MainContainer.Instance.getQuests();\r\n                    questCont.addQuest(quest);\r\n\r\n\r\n                    var building = katzenjammer.data.User.Instance.getBuildings()[questData.user_building_id];\r\n\r\n                    this.setUserBuilding(building);\r\n                    building.setQuest(this);\r\n                }\r\n                \r\n                //console.log(building.getName() + \" (\" + building.getID() + \") hat die Quest -> \" + quest.getName());\r\n            }\r\n        },\r\n\r\n\r\n        loadingUser: function (args)\r\n        {\r\n            if (args === null)\r\n            {\r\n                this.resetID();\r\n                this.resetSession();\r\n                this.resetName();\r\n                this.resetHome();\r\n                this.resetMoney();\r\n                this.resetGuild();\r\n\r\n                this.resetBuildings();\r\n\t\t\t}\r\n\r\n            for (var i in args)\r\n            {\r\n                var value = args[i];\r\n                switch (i)\r\n                {\r\n                    case \"id\": this.setID(value); break;\r\n                    case \"name\": this.setName(value); break;\r\n                    case \"session\": this.setSession(value); break;\r\n                    case \"home\": this.setHome(value); break;\r\n                    case \"money\": this.setMoney(value); break;\r\n                    case \"guild\": this.setGuild(value); break;\r\n                    default: console.log(\"Key \" + i + \" is not in use.\"); break;\r\n                }\r\n            }\r\n\r\n            this.loadingUserData();\r\n        },\r\n\r\n\r\n        updateHome: function (homeData)\r\n        {\r\n            this.setHome(homeData);\r\n\r\n            var data =\r\n            {\r\n                Action: \"userUpdate\",\r\n                Data: {\r\n                    id: this.getID(),\r\n                    home: this.getHome()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n            var req = new katzenjammer.data.ServiceRequest(data);\r\n            req.send();\r\n        },\r\n\r\n\r\n        loadingUserData: function ()\r\n        {\r\n            this.loadingUserBuildings();\r\n        },\r\n\r\n        loadingUserBuildings: function ()\r\n        {\r\n            var user = katzenjammer.data.User.Instance.getID();\r\n\r\n            var data = {\r\n                Action: \"select\",\r\n                Data: \"UserBuildings\",\r\n                ID: user\r\n            };\r\n\r\n            var req = new katzenjammer.data.ServiceRequest(data);\r\n            req.addListener(\"success\", function (e)\r\n            {\r\n                var response = e.getTarget().getResponse();\r\n                //console.log(response);\r\n\r\n                if (response.success)\r\n                {\r\n                    var data = e.getTarget().getResponse().data;\r\n\r\n                    var buildings = [];\r\n                    for (var i in data)\r\n                    {\r\n                        buildings[data[i].id] = new katzenjammer.data.UserBuilding(data[i]);\r\n                    }\r\n\r\n                    this.setBuildings(buildings);\r\n\r\n                    this.loadingHeroes();\r\n                    this.loadingQuests();\r\n                }\r\n            }, this);\r\n\r\n            req.send();\r\n        },\r\n\r\n\r\n        loadingHeroes: function () {\r\n            var user = katzenjammer.data.User.Instance.getID();\r\n\r\n            var data = {\r\n                Action: \"select\",\r\n                Data: \"UserHeroes\",\r\n                ID: user\r\n            };\r\n\r\n            var req = new katzenjammer.data.ServiceRequest(data);\r\n            req.addListener(\"success\", function (e) {\r\n                var response = e.getTarget().getResponse();\r\n\r\n                if (response.success)\r\n                {\r\n                    var data = e.getTarget().getResponse().data;\r\n                    var buildings = this.getBuildings();\r\n\r\n                    for (var i in data)\r\n                    {\r\n                        var hero = data[i];\r\n\r\n                        if (hero.name === null)\r\n                            hero.name = katzenjammer.data.GameData.Heroes[hero.hero_id].name\r\n\r\n                        if (hero.icon_id === null)\r\n                            hero.icon_id = katzenjammer.data.GameData.Heroes[hero.hero_id].icon_id;\r\n\r\n                        var building = buildings[hero.building_id];\r\n\r\n                        var bHeroes = building.getHeroes();\r\n                        if (bHeroes === null)\r\n                            bHeroes = [];\r\n\r\n                        bHeroes.push(hero);\r\n\r\n                        building.setHeroes(bHeroes);\r\n                    }\r\n\r\n                    katzenjammer.container.MainContainer.Instance.getBuildings().updateBuildingList();\r\n                }\r\n            }, this);\r\n\r\n            req.send();\r\n        },\r\n\r\n\r\n\r\n        loadingQuests: function ()\r\n        {\r\n            var user = katzenjammer.data.User.Instance.getID();\r\n\r\n            var data = {\r\n                Action: \"select\",\r\n                Data: \"Quests\",\r\n                ID: user\r\n            };\r\n\r\n            var req = new katzenjammer.data.ServiceRequest(data);\r\n            req.addListener(\"success\", function (e) {\r\n                var response = e.getTarget().getResponse();\r\n                //console.log(response);\r\n\r\n                if (response.success) {\r\n                    var data = e.getTarget().getResponse().data;\r\n                    var buildings = katzenjammer.data.User.Instance.getBuildings();\r\n\r\n                    var quests = [];\r\n                    for (var i in data)\r\n                    {\r\n                        var quest = new katzenjammer.data.Quest(data[i]);\r\n                        quests[data[i].user_building_id] = quest;\r\n                        var b = buildings[data[i].user_building_id];\r\n                        b.setQuest(quest);\r\n                    }\r\n\r\n                    this.setQuests(quests);\r\n\r\n                    katzenjammer.container.MainContainer.Instance.getQuests().updateQuestList();\r\n                }\r\n            }, this);\r\n\r\n            req.send();\r\n        }\r\n    }\r\n});\r\n"
  ]
}